var snakey3;snakey3=(()=>{"use strict";var e,t,s,n,r={572:(e,t,s)=>{s.r(t)},406:(e,t,s)=>{var n;s.d(t,{R:()=>n}),function(e){let t;function s(e,t,s){t.forEach((t=>{if(!Object.getOwnPropertyNames(e).includes(t)){const s=`\`${e.__proto__.constructor.name}\` instance has no property named "${t}"`;throw new TypeError(s)}Object.defineProperty(e,t,s)}))}e.applyMixins=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((s=>{Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s))}))}))},e.deepFreeze=function e(t){return function(t){for(const s of Object.getOwnPropertyNames(t)){const n=t[s];"object"==typeof n&&e(n)}Object.freeze(t)}(t),t},function(e){let t;!function(e){e.access=function(e,t,s){s.enumerable=!1},e.cyclic=function(e,t,s){s.enumerable=!1}}(t=e.NonEnumerable||(e.NonEnumerable={}))}(t=e.Decor||(e.Decor={})),e.protoNoEnum=function(e,t){t.forEach((t=>{if(!Object.getOwnPropertyNames(e.prototype).includes(t)){const s=`\`${e.name}\` prototype has no property named "${t}"`;throw new TypeError(s)}Object.defineProperty(e.prototype,t,{enumerable:!1})}))},e.instNoEnum=function(e,t){s(e,t,{enumerable:!1})},e.propNoWrite=function(e,t){s(e,t,{writable:!1})},e.prependComment=function(e,t){e.parentNode.insertBefore(document.createComment(" "+t+" "),e)},e.camelCaseTransforms=function(e){const t=e.replace(/[A-Z]/g,(e=>" "+e.toLowerCase()));return Object.freeze({spaceyLowercase:t,spaceyUppercase:t.toUpperCase(),spaceyCapitalized:t.split(" ").map((e=>e.charAt(0).toUpperCase()+e.substring(1))).join(" ")})},e.mkEl=function(e,t,s){const n=document.createElement(e);try{Object.seal(n)}catch(e){}return n.classList.add(...t),"button"===e?n.type="button":"a"===e&&(n.rel="noopener"),void 0!==s&&Object.assign(n,s),n}}(n||(n={})),Object.freeze(n)},80:(e,t,s)=>{s.d(t,{Y:()=>n});var n,r=s(406);!function(e){let t,s,n,r,o,i;e.GLOBAL_IDS={PUBLIC_GAME_HOST_URLS:"public-game-hosts-list",CURRENT_HOST_GROUPS:"current-host-groups-list"},function(e){e.Class={TEXT_SELECT_DISABLED:"text-select-disabled",FILL_PARENT:"fill-parent",CENTER_CONTENTS:"center-contents",STACK_CONTENTS:"stack-contents",INPUT_GROUP:"sk-input-group",INPUT_GROUP_ITEM:"sk-input-group-item"},e.Dataset={COLOUR_SCHEME:"skColourScheme"}}(t=e.General||(e.General={})),function(e){e.Class={BASE:"tile",POINTER_HB:"tile__pointer-hitbox",LANG_CHAR_WRAP:"tile__char",LANG_SEQ:"tile__seq"},e.Dataset={HEALTH:"health"}}(s=e.Tile||(e.Tile={})),function(e){e.Class={GRID:"game-grid",SCROLL_OUTER:"game-grid-scroll-outer",SCROLL_INNER:"game-grid-scroll-inner",IMPL_BODY:"game-grid-impl-body",KBD_DC:"game-grid-kbd-dc",KBD_DC_ICON:"game-grid-kbd-dc__icon",PAUSE_OL:"game-grid-pause-overlay",PAUSE_OL_ICON:"game-grid-pause-overlay__icon",PLAYER_IOB_ROOT:"grid-player-intersection-root"},e.Dataset={IMPL_COORD_SYS:"coordSys",GAME_STATE:{KEY:"gameState",VALUES:{PLAYING:"playing",PAUSED:"paused",OVER:"over"}}}}(n=e.Grid||(e.Grid={})),function(e){e.Class={BASE:"player",FACE:"player__face",DOWNED_OVERLAY:"player__downed-overlay",SHORT_SPOTLIGHT:"player__spotlight-short",LONG_SPOTLIGHT:"player__spotlight-long"},e.Dataset={DOWNED:{KEY:"downed",VALUES:{TEAM:"team",SELF:"self",NO:"no"}},FACE_SWATCH:"face"}}(r=e.Player||(e.Player={})),function(e){let t;e.Id={ALL_SCREENS:"all-screens-container",SCREEN_TINT:"screen-tint"},e.Class={BASE:"sk-screen",NAV_NEXT:"screen--next-button",NAV_PREV:"screen--prev-button"},e.Dataset={CURRENT:"current"},function(e){let t,s,n,r,o,i;!function(e){e.Class={BASE:"screen-home",NAV:"screen-home--nav",NAV_PLAY_OFFLINE:"screen-home--nav--play-offline",NAV_PLAY_ONLINE:"screen-home--nav--play-online",NAV_HOW_TO_PLAY:"screen-home--nav--how-to-play",NAV_HOW_TO_HOST:"screen-home--nav--how-to-host",NAV_COLOURS:"screen-home--nav--colour-scheme",NAV_VIEW_REPO:"screen-home--nav--goto-repo",NAV_RPT_ISSUE:"screen-home--nav--report-issue"}}(t=e.Home||(e.Home={})),function(e){e.Class={BASE:"screen-colour",OPTION:"screen-colour--opt",OPTION_LABEL:"screen-colour--opt-label",OPTION_LABEL_TITLE:"screen-colour--opt-label--title",OPTION_LABEL_AUTHOR:"screen-colour--opt-label--author"}}(s=e.ColourCtrl||(e.ColourCtrl={})),function(e){e.Class={BASE:"screen-play",GRID_WRAPPER:"screen-play--grid-wrapper",CONTROLS_BAR:"screen-play--controls-bar",PLAYERS_BAR:"screen-play--players-bar"}}(n=e.Play||(e.Play={})),function(e){e.Class={BASE:"screen-setup",LANG_SEL:"screen-setup--lang-sel",LANG_WEIGHT_EXAGG:"screen-setup--lang-weight-exagg"},e.Id={LANG_WEIGHT_EXAGGERATION_LIST:"screen-setup--lang-weight-exaggeration-list"}}(r=e.Setup||(e.Setup={})),function(e){e.Class={BASE:"screen-joiner",CONTENT_WRAPPER:"screen-joiner--content-wrapper",HOST_URL:"screen-joiner--host-url",GROUP_NAME:"screen-joiner--group-name",PASSPHRASE:"screen-joiner--passphrase"}}(o=e.GroupJoiner||(e.GroupJoiner={})),function(e){e.Class={BASE:"screen-lobby",SEC_CLIENT_INFO:"screen-lobby--client-info-section",SEC_TEAMS:"screen-lobby--teams-section",TEAM:"screen-lobby--team",PLAYER:"screen-lobby--player",PLAYER_NAME:"screen-lobby--player__name"}}(i=e.GroupLobby||(e.GroupLobby={}))}(t=e.Impl||(e.Impl={}))}(o=e.Screen||(e.Screen={})),function(e){e.Class={BASE:"sk-pick-one",OPT_BASE:"sk-pick-one--opt"}}(i=e.SkPickOne||(e.SkPickOne={}))}(n||(n={})),Object.freeze(n.Player.Dataset.DOWNED),r.R.deepFreeze(n)},502:(e,t,s)=>{s.d(t,{b4:()=>n,ZA:()=>r,m4:()=>o,JD:()=>i});class n{}!function(e){var t;let s;e.PROTOCOL="http://",e.DEFAULT_PORT=(null===(t=null===process||void 0===process?void 0:process.env)||void 0===t?void 0:t.PORT)||80,function(e){e.GROUP_JOINER="/joiner.",e.GROUP_LOBBY_PREFIX="/group.",e.GROUP_GAME_PREFIX="/group-game."}(s=e.Nsps||(e.Nsps={}))}(n||(n={})),Object.freeze(n),Object.freeze(n.prototype);class r{}var o,i;!function(e){let t,s,n,r;!function(e){let t;!function(e){e.EVENT_NAME="group-lobby-user-info-change"}(t=e.UserInfoChange||(e.UserInfoChange={}))}(t=e.Socket||(e.Socket={})),function(e){e.REGEXP=/(?:[a-zA-Z0-9:-]+)/,e.MaxLength=30}(s=e.Name||(e.Name={})),function(e){e.REGEXP=/(?:[a-zA-Z0-9:-]*)/,e.MaxLength=30}(n=e.Passphrase||(e.Passphrase={})),e.GameServerReconnectionAttempts=2,e.DEFAULT_TTL=20,function(e){e.EVENT_NAME="group-exist";class t{constructor(e,t){this.groupName=e,this.passphrase=t}}let s;e.RequestCreate=t,function(e){let t;!function(e){e.OKAY="okay",e.NOPE="nope"}(t=e.Response||(e.Response={}))}(t=e.RequestCreate||(e.RequestCreate={})),function(e){e.IN_LOBBY="in-lobby",e.IN_GAME="in-game",e.DELETE="delete"}(s=e.Status||(e.Status={}))}(r=e.Exist||(e.Exist={}))}(r||(r={})),Object.freeze(r),Object.freeze(r.prototype),function(e){e.CREATE_GAME="group-game-create"}(o||(o={})),function(e){e.CREATE_GAME="game-create",e.RESET="game-reset",e.UNPAUSE="game-unpause",e.PAUSE="game-pause",e.RETURN_TO_LOBBY="game-return-to-lobby"}(i||(i={}))},951:(e,t,s)=>{s.d(t,{Bl:()=>n,J5:()=>r,Uo:()=>o});const n=Object.freeze({behavior:"smooth",block:"center",inline:"center"});class r{}!function(e){let t,s,n;e.Family=Object.freeze({HUMAN:"HUMAN",CHASER:"CHASER"}),e.Family,function(e){e.NULL=void 0}(t=e.Id||(e.Id={})),function(e){e.REGEXP=/[ a-zA-Z0-9:-]+/,e.MAX_LENGTH=15}(s=e.Username||(e.Username={})),function(e){e.LOREM_IPSUM="lorem-ipsum"}(n=e.Avatar||(e.Avatar={})),function(e){const t=Object.values(e).filter((e=>"string"==typeof e));e.GET_RANDOM=function(){return t[Math.random()*t.length]}}(n=e.Avatar||(e.Avatar={})),e.MoveType=Object.freeze({NORMAL:"NORMAL",BOOST:"BOOST"}),e.MoveType}(r||(r={})),Object.freeze(r),Object.freeze(r.prototype);class o{}!function(e){let t,s,n;!function(e){e.REGEXP=new RegExp("^[a-zA-Z0-9!@#$%^&*()-_=+;:'\"\\|,.<>/?]+$")}(t=e.Seq||(e.Seq={})),function(e){e.NULL=Object.freeze({char:"",seq:""})}(s=e.CharSeqPair||(e.CharSeqPair={})),function(e){e.MAX=4}(n=e.WeightExaggeration||(e.WeightExaggeration={})),e.CHAR_HIT_COUNT_SEED_CEILING=5,e._RemapTemplates=Object.freeze({IDENTITY:e=>e,TO_LOWER:e=>e.toLowerCase()}),e._RemapTemplates,e.FrontendDescs=Object.freeze([{id:"engl-low",module:"English",export:"Lowercase",numLeaves:26,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"English Lowercase (qwerty)",blurb:""},{id:"engl-mix",module:"English",export:"MixedCase",numLeaves:52,remapFunc:e._RemapTemplates.IDENTITY,displayName:"English Mixed-Case (Querty)",blurb:""},{id:"japn-hir",module:"Japanese",export:"Hiragana",numLeaves:71,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"Japanese Hiragana",blurb:""},{id:"japn-kat",module:"Japanese",export:"Katakana",numLeaves:70,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"Japanese Katakana",blurb:""},{id:"kore-dub",module:"Korean",export:"Dubeolsik",numLeaves:9177,remapFunc:e._RemapTemplates.IDENTITY,displayName:"Korean Dubeolsik (ë‘ë²Œì‹ í‚¤ë³´ë“œ)",blurb:"The most common keyboard layout, and South Korea's only Hangul standard since 1969. Consonants are on the left, and vowels on the right."},{id:"kore-sub",module:"Korean",export:"Sebeolsik",numLeaves:10206,remapFunc:e._RemapTemplates.IDENTITY,displayName:"Korean Sebeolsik (ì„¸ë²Œì‹ ìµœì¢… í‚¤ë³´ë“œ)",blurb:"Another Hangul keyboard layout used in South Korea, and the final Sebeolsik layout designed by Dr. Kong Byung Woo, hence the name. Syllable-initial consonants are on the right, final consonants on the left, and vowels in the middle. It is more ergonomic than the dubeolsik, but not widely used."},{id:"kore-rom",module:"Korean",export:"Romanization",numLeaves:3990,remapFunc:e._RemapTemplates.TO_LOWER,displayName:"Korean Revised Romanization",blurb:"The Revised Romanization of Korean (êµ­ì–´ì˜ ë¡œë§ˆìž í‘œê¸°ë²•; åœ‹èªžì˜ ë¡œë§ˆå­— è¡¨è¨˜æ³•) is the official South Korean language romanization system. It was developed by the National Academy of the Korean Language from 1995, and was released on 7 July 2000 by South Korea's Ministry of Culture and Tourism"},{id:"engl-cell-enc",module:"English",export:"OldCellphone.Encode",numLeaves:8,remapFunc:e._RemapTemplates.IDENTITY,displayName:"Old Cellphone Keyboard",blurb:""}].map((e=>Object.freeze(e)))),e.FrontendDescs,e.GET_FRONTEND_DESC_BY_ID=function(t){return e.FrontendDescs.find((e=>e.id===t))}}(o||(o={})),Object.freeze(o),Object.freeze(o.prototype)},504:(e,t,s)=>{var n;s.d(t,{l:()=>n}),function(e){let t,s;!function(e){e.SERVER="SERVER",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(t=e.Type||(e.Type={})),Object.freeze(t),function(e){e.PLAYING="PLAYING",e.PAUSED="PAUSED",e.OVER="OVER"}(s=e.Status||(e.Status={})),Object.freeze(s),e.K=Object.freeze({HEALTH_UPDATE_CHANCE:.1,AVERAGE_HEALTH_TO_SPAWN_ON_TILE:1,PORTION_OF_MOVES_THAT_ARE_BOOST:.4,HEALTH_COST_OF_BOOST(e,t){const s=t(this.AVERAGE_HEALTH_TO_SPAWN_ON_TILE/e);return this.AVERAGE_HEALTH_TO_SPAWN_ON_TILE/s/this.PORTION_OF_MOVES_THAT_ARE_BOOST},HEALTH_EFFECT_FOR_DOWNED_PLAYER:.6,EVENT_RECORD_WRAPPING_BUFFER_LENGTH:128,EVENT_RECORD_FORWARD_WINDOW_LENGTH:64})}(n||(n={})),Object.freeze(n)},735:(e,t,s)=>{s.r(t),s.d(t,{OmHooks:()=>l.Y,game:()=>$,screen:()=>Z,top:()=>X});var n,r,o,i=s(655),a=s(406),l=s(80),c=s(951);!function(e){let t;function s(e,t){const s={};return Object.keys(t).forEach((t=>{Object.defineProperty(s,t,{enumerable:!0,get:()=>{const s=e.getItem(t);return null===s?void 0:JSON.parse(s)},set:s=>{e.setItem(t,JSON.stringify(s))}})})),Object.freeze(s),s}e.Local=s(localStorage,{musicVolume:1,sfxVolume:1,colourSchemeId:"",colourSchemeStyleLiteral:"",gamePresetId:"",username:"",avatar:""}),e.getLastUserInfo=function(){var t,s;return Object.freeze({username:null!==(t=e.Local.username)&&void 0!==t?t:"unnamed player",teamId:0,avatar:null!==(s=e.Local.avatar)&&void 0!==s?s:c.J5.Avatar.GET_RANDOM()})},e.Session=s(localStorage,Object.freeze({})),function(e){let t;e.DB_NAME="snakeyDB",function(e){e.STORE_NAME="userGamePresets"}(t=e.UserGamePresetStore||(e.UserGamePresetStore={})),Object.freeze(t)}(t=e.IDB||(e.IDB={})),Object.freeze(t)}(n||(n={})),Object.freeze(n);const p=l.Y.Screen.Class;class d{constructor(e,t,s,n){r.set(this,void 0),o.set(this,void 0),this.screenId=e,this.screenNames=a.R.camelCaseTransforms(e),this.top=t,(0,i.YH)(this,r,s),this.requestGoToScreen=n,this.baseElem=a.R.mkEl("div",[p.BASE]),(0,i.YH)(this,o,!1),this.nav=Object.freeze({prev:a.R.mkEl("button",[]),next:a.R.mkEl("button",[])}),a.R.propNoWrite(this,["screenId","top","baseElem","nav","requestGoToScreen"]),this.nav.prev.classList.add(p.NAV_PREV),this.nav.next.classList.add(p.NAV_NEXT),this.nav.prev.textContent="Back",this.nav.next.textContent="Next",this.nav.prev.onclick=t=>{const s=d.NavTree,n=s[this.screenId];s[n.prev].href===n.href?this.requestGoToScreen(d.NavTree[e].prev,{}):window.history.back()}}_enter(e,t){var s;return(0,i.mG)(this,void 0,void 0,(function*(){if(document.title=`${this.screenNames.spaceyCapitalized} | ${this.top.defaultDocTitle}`,e===d.NavDir.FORWARD){const e=new window.URL(window.location.href),t=e.hash=d.NavTree[this.screenId].href,n=[{screenId:this.screenId},"",e.href];(null===(s=window.history.state)||void 0===s?void 0:s.screenId)!==t&&(d.NavTree[this.screenId].prev===this.screenId?history.replaceState(...n):history.pushState(...n))}(0,i.Q_)(this,o)||(this._lazyLoad(),(0,i.Q_)(this,r).appendChild(this.baseElem),a.R.prependComment(this.baseElem,this.screenNames.spaceyUppercase+" SCREEN"),this.baseElem.setAttribute("aria-label",this.screenNames.spaceyCapitalized+" Screen"),(0,i.YH)(this,o,!0)),yield this._abstractOnBeforeEnter(e,t)}))}_leave(e){return!!this._abstractOnBeforeLeave(e)}_onAfterEnter(){this.baseElem.dataset[l.Y.Screen.Dataset.CURRENT]="",this.baseElem.setAttribute("aria-hidden","false")}_onAfterLeave(){delete this.baseElem.dataset[l.Y.Screen.Dataset.CURRENT],this.baseElem.setAttribute("aria-hidden","true")}getRecommendedFocusElem(){}_abstractOnBeforeEnter(e,t){return(0,i.mG)(this,void 0,void 0,(function*(){}))}_abstractOnBeforeLeave(e){return!0}}r=new WeakMap,o=new WeakMap,function(e){let t,s,n;!function(e){e.HOME="home",e.HOW_TO_PLAY="howToPlay",e.HOW_TO_HOST="howToHost",e.COLOUR_CTRL="colourControl",e.SETUP_OFFLINE="setupOffline",e.PLAY_OFFLINE="playOffline",e.GROUP_JOINER="groupJoiner",e.SETUP_ONLINE="setupOnline",e.GROUP_LOBBY="groupLobby",e.PLAY_ONLINE="playOnline"}(t=e.Id||(e.Id={})),Object.freeze(t),s=e.HistoryEntryId||(e.HistoryEntryId={}),e.NavTree=Object.freeze({[t.HOME]:{prev:t.HOME,href:t.HOME},[t.HOW_TO_PLAY]:{prev:t.HOME,href:t.HOW_TO_PLAY},[t.HOW_TO_HOST]:{prev:t.HOME,href:t.HOW_TO_HOST},[t.COLOUR_CTRL]:{prev:t.HOME,href:t.COLOUR_CTRL},[t.SETUP_OFFLINE]:{prev:t.HOME,href:t.SETUP_OFFLINE},[t.PLAY_OFFLINE]:{prev:t.SETUP_OFFLINE,href:t.SETUP_OFFLINE},[t.GROUP_JOINER]:{prev:t.HOME,href:t.GROUP_JOINER},[t.GROUP_LOBBY]:{prev:t.GROUP_JOINER,href:t.GROUP_JOINER},[t.SETUP_ONLINE]:{prev:t.GROUP_LOBBY,href:t.GROUP_JOINER},[t.PLAY_ONLINE]:{prev:t.GROUP_LOBBY,href:t.GROUP_JOINER}}),Object.entries(e.NavTree).forEach((([s,n])=>{let r=s;const o=new Set;do{if(o.has(r))throw new Error("Navigation tree must not contain cycles.");if(o.add(r),r=e.NavTree[r].prev,r===s)break}while(r!==e.NavTree[r].prev);if(r!==t.HOME)throw new Error("The home screen must be the root of the screen-navigation tree.")})),function(e){e.FORWARD="forward",e.BACKWARD="backward"}(n=e.NavDir||(e.NavDir={})),e.GET_NAV_DIR=function(t){const{curr:s,dest:n}=t;if(void 0===s)return e.NavDir.FORWARD;let r=s;for(;r!==e.NavTree[r].prev;)if(r=e.NavTree[r].prev,r===n)return e.NavDir.BACKWARD;return e.NavDir.FORWARD}}(d||(d={})),Object.freeze(d),Object.freeze(d.prototype);class h extends d{_lazyLoad(){const e=l.Y.Screen.Impl.Home.Class;this.baseElem.classList.add(l.Y.General.Class.CENTER_CONTENTS,e.BASE);const t=this.navElem=a.R.mkEl("div",[l.Y.General.Class.TEXT_SELECT_DISABLED,l.Y.General.Class.INPUT_GROUP,e.NAV]);t.setAttribute("role","navigation"),t.addEventListener("pointerleave",(()=>{var e;(null===(e=document.activeElement)||void 0===e?void 0:e.parentElement)===t&&document.activeElement.blur()}));const s=(e,s)=>{e.classList.add(l.Y.General.Class.CENTER_CONTENTS,l.Y.General.Class.INPUT_GROUP_ITEM,s.cssClass),e.textContent=s.text,e.addEventListener("pointerenter",(()=>{window.requestAnimationFrame((t=>{e.focus()}))})),t.appendChild(e)};[{text:"Offline Single-player",cssClass:e.NAV_PLAY_OFFLINE,screenId:d.Id.SETUP_OFFLINE},{text:"Online Multi-player",cssClass:e.NAV_PLAY_ONLINE,screenId:d.Id.GROUP_JOINER},{text:"How To Play",cssClass:e.NAV_HOW_TO_PLAY,screenId:d.Id.HOW_TO_PLAY},{text:"How To Host",cssClass:e.NAV_HOW_TO_HOST,screenId:d.Id.HOW_TO_HOST},{text:"Colour Schemes",cssClass:e.NAV_COLOURS,screenId:d.Id.COLOUR_CTRL}].map((e=>Object.freeze(e))).forEach((e=>{const t=a.R.mkEl("button",[]);t.onclick=e.screenId instanceof Function?e.screenId:()=>{this.requestGoToScreen(e.screenId,{})},s(t,e)})),[{text:"Visit\nRepo",cssClass:e.NAV_VIEW_REPO,href:new window.URL("https://github.com/david-fong/snakey3")},{text:"Report\nIssue",cssClass:e.NAV_RPT_ISSUE,href:new window.URL("https://github.com/david-fong/snakey3/issues")}].map((e=>Object.freeze(e))).forEach((e=>{const t=a.R.mkEl("a",[],{href:e.href.toString(),target:"_blank"});s(t,e)})),this.baseElem.appendChild(t)}}Object.freeze(h),Object.freeze(h.prototype);class u extends d{_lazyLoad(){}}Object.freeze(u),Object.freeze(u.prototype);class m extends d{_lazyLoad(){}}var E,_,O;!function(e){e.INSTRUCTIONS_STEPS=Object.freeze(["$ npm install 'https://github.com/david-fong/snakey3#gh-pages'","$ npm run start","send the url to your friends"])}(m||(m={})),Object.freeze(m),Object.freeze(m.prototype);class v{constructor(){E.set(this,void 0),_.set(this,void 0),O.set(this,void 0);const e=a.R.mkEl("div",[l.Y.SkPickOne.Class.BASE],{tabIndex:0});e.setAttribute("role","listbox"),e.addEventListener("keydown",this._onKeyDown.bind(this)),e.addEventListener("pointerenter",(t=>{window.requestAnimationFrame((t=>{e.focus()}))})),this.baseElem=e,this.options=[]}addOption(e){this.options.push(e),this.baseElem.appendChild(e.baseElem),e.baseElem.addEventListener("pointerenter",this.hoverOpt.bind(this,e)),e.baseElem.addEventListener("click",this.selectOpt.bind(this,e,!0)),e._registerParent(this._onOptDisabledChange.bind(this))}hoverOpt(e){var t;this.hoveredOpt!==e&&(null===(t=this.hoveredOpt)||void 0===t||t.baseElem.setAttribute("aria-active-descendant","false"),(0,i.YH)(this,_,e),this.hoveredOpt.baseElem.setAttribute("aria-active-descendant","true"))}selectOpt(e,t=!0){var s;if(!e)throw new Error("opt must be defined");this.hoverOpt(e),this.confirmedOpt!==e&&(null===(s=this.confirmedOpt)||void 0===s||s.baseElem.setAttribute("aria-selected","false"),(0,i.YH)(this,E,e),this.confirmedOpt.baseElem.setAttribute("aria-selected","true"),t&&this._onSelectOpt(e))}get confirmedOpt(){return(0,i.Q_)(this,E)}get hoveredOpt(){return(0,i.Q_)(this,_)}_onOptDisabledChange(e){this.confirmedOpt===e&&(this._isValid=!e.disabled)}set _isValid(e){this._isValid!==e&&(this.baseElem.setAttribute("aria-invalid",e?"false":"true"),(0,i.YH)(this,O,e))}get _isValid(){return(0,i.Q_)(this,O)}_onKeyDown(e){if(" "===e.key||"Enter"===e.key)return this.selectOpt(this.hoveredOpt),e.preventDefault(),!1;{const t=this.options.indexOf(this.hoveredOpt);if("ArrowDown"===e.key||"Down"===e.key)for(let s=t+1;s<this.options.length;s++){const t=this.options[s];if(!t.disabled)return this.hoverOpt(t),e.preventDefault(),!1}else if("ArrowUp"===e.key||"Up"===e.key)for(let s=t-1;s>=0;s--){const t=this.options[s];if(!t.disabled)return this.hoverOpt(t),e.preventDefault(),!1}}return!0}}E=new WeakMap,_=new WeakMap,O=new WeakMap,function(e){var t,s;t=new WeakMap,s=new WeakMap,e._Option=class{constructor(){t.set(this,void 0),s.set(this,void 0),(this.baseElem=a.R.mkEl("div",[l.Y.SkPickOne.Class.OPT_BASE])).setAttribute("role","option"),(0,i.YH)(this,t,!1)}_registerParent(e){(0,i.YH)(this,s,e)}get disabled(){return(0,i.Q_)(this,t)}set disabled(e){this.disabled!==e&&(this.baseElem.setAttribute("aria-disabled",e?"true":"false"),(0,i.YH)(this,t,e),(0,i.Q_)(this,s).call(this,this))}},Object.freeze(e),Object.freeze(e.prototype)}(v||(v={})),Object.freeze(v),Object.freeze(v.prototype),s(572);const f=l.Y.Screen.Impl.ColourCtrl.Class;l.Y.General.Class;class g extends d{_lazyLoad(){this.baseElem.classList.add(f.BASE),this.baseElem.appendChild(this.nav.prev);const e=this.sel=new g.PickOne(this.top.storage.Local,this.top.transition);a.R.propNoWrite(this,["sel"]),this.baseElem.appendChild(e.baseElem);const t=this.top.storage.Local.colourSchemeId;t&&this.sel.selectOpt(this.sel.getOptById(t),!1)}}var b;!function(e){var t,s,n;class r extends v{constructor(e,o){var a;super(),t.set(this,void 0),s.set(this,void 0),n.set(this,void 0),(0,i.YH)(this,t,!0),(0,i.YH)(this,s,e),(0,i.YH)(this,n,o),b.Schemes.forEach((e=>{this.addOption(new r.Option(e))})),this.selectOpt(this.getOptById(null!==(a=(0,i.Q_)(this,s).colourSchemeId)&&void 0!==a?a:"snakey"),!1)}_onHoverOpt(e){}_onSelectOpt(e){(0,i.Q_)(this,s).colourSchemeId=e.desc.id,(0,i.Q_)(this,s).colourSchemeStyleLiteral=e.cssLiteral;const r=(0,i.Q_)(this,t);(0,i.YH)(this,t,!1),(0,i.Q_)(this,n).do({intermediateTransitionTrigger:()=>{document.documentElement.dataset[l.Y.General.Dataset.COLOUR_SCHEME]=e.desc.id;const t=document.documentElement.style;if(r)for(const e of b.Swatch){const s="--colour-"+e;t.setProperty(s,"")}}})}getOptById(e){return this.options.find((t=>t.desc.id===e))}}t=new WeakMap,s=new WeakMap,n=new WeakMap,e.PickOne=r,function(e){class t extends v._Option{constructor(e){super(),this.desc=e;const s=this.baseElem;s.classList.add(f.OPTION),s.dataset[l.Y.General.Dataset.COLOUR_SCHEME]=e.id;const n=a.R.mkEl("span",[f.OPTION_LABEL]);n.appendChild(a.R.mkEl("div",[f.OPTION_LABEL_TITLE],{textContent:e.displayName})),n.appendChild(a.R.mkEl("div",[f.OPTION_LABEL_AUTHOR],{textContent:"by "+e.author})),s.appendChild(n);for(let e=0;e<t.NUM_PREVIEW_SLOTS-1;e++)s.appendChild(a.R.mkEl("span",[]));document.body.appendChild(s);let r="";const o=window.getComputedStyle(s);for(const e of b.Swatch){const t="--colour-"+e;r+=t+":"+o.getPropertyValue(t)+";"}this.cssLiteral=r}}e.Option=t,function(e){e.NUM_PREVIEW_SLOTS=8}(t=e.Option||(e.Option={})),Object.freeze(t),Object.freeze(t.prototype)}(r=e.PickOne||(e.PickOne={})),Object.freeze(r),Object.freeze(r.prototype)}(g||(g={})),Object.freeze(g),Object.freeze(g.prototype),function(e){e.Swatch=Object.freeze(["mainFg","mainBg","tileFg","tileBg","tileBd","healthFg","healthBg","pFaceMe","pFaceMeOppo","pFaceTeammate","pFaceImtlTeammate","pFaceOpponent","pFaceImtlOpponent"]),e.Schemes=Object.freeze([{id:"snakey",displayName:"Snakey",author:"N.W."},{id:"smooth-stone",displayName:"Smooth Stone",author:"Dav"},{id:"murky-dive",displayName:"Murky Dive",author:"Stressed Dav"}].map((e=>Object.freeze(e))))}(b||(b={})),Object.freeze(b);const T=l.Y.Screen.Impl.Setup.Class;class S extends d{_lazyLoad(){this.baseElem.classList.add(T.BASE),this.baseElem.appendChild(this.nav.prev),this.langSel=new S.LangPickOne,this.baseElem.appendChild(this.langSel.baseElem),this._createLangWeightExaggerationInput(),a.R.propNoWrite(this,["langSel","langWeightExaggeration"]),this.baseElem.appendChild(this.nav.next),this._loadLastUsedPreset()}_createLangWeightExaggerationInput(){const e=this.langWeightExaggeration=a.R.mkEl("input",[T.LANG_WEIGHT_EXAGG],{type:"range",min:"0",max:c.Uo.WeightExaggeration.MAX.toString(),step:"any",value:"1"});{const e=a.R.mkEl("datalist",[]);e.id=l.Y.Screen.Impl.Setup.Id.LANG_WEIGHT_EXAGGERATION_LIST,[{val:0,label:"0"},{val:1,label:"1"}].forEach((t=>{e.appendChild(a.R.mkEl("option",[],{value:t.val.toString(),label:t.label}))})),this.baseElem.appendChild(e)}e.setAttribute("list",l.Y.Screen.Impl.Setup.Id.LANG_WEIGHT_EXAGGERATION_LIST),this.baseElem.appendChild(e)}getRecommendedFocusElem(){return this.nav.next}_loadLastUsedPreset(){this.top.storage.Local.gamePresetId}parseArgsFromGui(){const e=Object.assign({},S.DEFAULT_PRESET());return e.langId=this.langSel.confirmedOpt.desc.id,e.langWeightExaggeration=parseFloat(this.langWeightExaggeration.value),e}}!function(e){e.DEFAULT_PRESET=()=>({coordSys:"EUCLID2",gridDimensions:{height:21,width:21},averageFreeHealthPerTile:1/45,langWeightExaggeration:1,langId:"engl-low",playerDescs:[{isALocalOperator:!1,familyId:"CHASER",teamId:1,clientId:void 0,username:"chaser1",avatar:void 0,noCheckGameOver:!0,familyArgs:{}},{isALocalOperator:!1,familyId:"CHASER",teamId:1,clientId:void 0,username:"chaser2",avatar:void 0,noCheckGameOver:!0,familyArgs:{fearDistance:6,bloodThirstDistance:5,healthReserve:5,keyPressesPerSecond:1.8}}]});class t extends v{constructor(){super(),this.baseElem.classList.add(T.LANG_SEL),c.Uo.FrontendDescs.forEach((e=>{this.addOption(new t.Option(e))})),this.selectOpt(this.options[0])}_onHoverOpt(e){}_onSelectOpt(e){}}e.LangPickOne=t,function(e){class t extends v._Option{constructor(e){super(),this.desc=e,this.baseElem.textContent=e.displayName}}e.Option=t,Object.freeze(t),Object.freeze(t.prototype)}(t=e.LangPickOne||(e.LangPickOne={}))}(S||(S={})),Object.freeze(S),Object.freeze(S.prototype);class N extends S{_lazyLoad(){super._lazyLoad(),this.nav.next.onclick=e=>{const t=this.parseArgsFromGui();this.requestGoToScreen(d.Id.PLAY_OFFLINE,t)}}parseArgsFromGui(){const e=super.parseArgsFromGui();return e.playerDescs.splice(e.playerDescs.length,0,{isALocalOperator:!0,familyId:"HUMAN",teamId:0,clientId:void 0,username:"hello1",avatar:void 0,noCheckGameOver:!1,familyArgs:{}},{isALocalOperator:!0,familyId:"HUMAN",teamId:1,clientId:void 0,username:"hello2",avatar:void 0,noCheckGameOver:!1,familyArgs:{}}),e}}Object.freeze(N),Object.freeze(N.prototype);var R,L,A,y,I=s(504);class C extends d{constructor(){super(...arguments),R.set(this,void 0),L.set(this,void 0),A.set(this,void 0),y.set(this,void 0)}_lazyLoad(){this.baseElem.classList.add(l.Y.General.Class.CENTER_CONTENTS,l.Y.Screen.Impl.Play.Class.BASE);const e=C.createCenterColElem();this._gridBaseElem=e.grid,this._gridImplHost=e.implHost,this._gridImplHost.appendChild(document.createComment("grid impl host")),this.baseElem.appendChild(e.top),e.pauseOl.addEventListener("click",(e=>{const t=this.currentGame;void 0!==t&&t.status===I.l.Status.PAUSED&&this._statusBecomePlaying()})),a.R.propNoWrite(this,["_gridBaseElem","_gridImplHost"]),this._initializeControlsBar(),this._initializePlayersBar(),(0,i.YH)(this,L,(()=>{if(this.wantsAutoPause)if(document.hidden){if(void 0===(0,i.Q_)(this,y)){const e=this.currentGame;(void 0===e||void 0!==e&&e.status!==I.l.Status.OVER)&&this._statusBecomePaused()}}else"page-hide"===(0,i.Q_)(this,y)&&this._statusBecomePlaying()})),(0,i.YH)(this,A,this._gridKeyDownCallback.bind(this))}_abstractOnBeforeEnter(e,t){return(0,i.mG)(this,void 0,void 0,(function*(){document.addEventListener("visibilitychange",(0,i.Q_)(this,L)),this.pauseButton.disabled=!0,this._statusBecomePaused(),(0,i.YH)(this,R,yield this._createNewGame(t)),this._gridBaseElem.addEventListener("keydown",(0,i.Q_)(this,A),{capture:!0}),yield this.currentGame.reset();const e=this.currentGame.htmlElements;this._gridImplHost.appendChild(e.gridImpl),this.playersBar.appendChild(e.playersBar),this.pauseButton.onclick=this._statusBecomePlaying.bind(this),this.pauseButton.disabled=!1,this.wantsAutoPause&&setTimeout((()=>{document.hidden||this._statusBecomePlaying()}),500)}))}_abstractOnBeforeLeave(e){if(this.askConfirmBeforeLeave&&!window.confirm("Are you sure you would like to leave?"))return!1;document.removeEventListener("visibilitychange",(0,i.Q_)(this,L)),this.currentGame.statusBecomePaused();for(const e of Object.values(this.currentGame.htmlElements))e.textContent="",e.remove();return this._gridBaseElem.removeEventListener("keydown",(0,i.Q_)(this,A)),(0,i.YH)(this,R,void 0),!0}get currentGame(){return(0,i.Q_)(this,R)}get probeCurrentGame(){return(0,i.Q_)(this,R)}_gridKeyDownCallback(e){e.stopPropagation();const t=this.currentGame;if(e.ctrlKey&&" "===e.key&&!e.repeat){const e=t.operators;t.setCurrentOperator((1+e.indexOf(t.currentOperator))%e.length)}else t.currentOperator.processKeyboardInput(e);return" "!==e.key||(e.preventDefault(),!1)}_statusBecomePlaying(){var e;const t=l.Y.Grid.Dataset.GAME_STATE;null===(e=this.probeCurrentGame)||void 0===e||e.statusBecomePlaying(),this.pauseButton.textContent="Pause",(0,i.YH)(this,y,void 0),this._gridBaseElem.dataset[t.KEY]=t.VALUES.PLAYING,this.pauseButton.onclick=this._statusBecomePaused.bind(this),this.resetButton.disabled=!0,window.requestAnimationFrame((e=>{this._gridBaseElem.focus()}))}_statusBecomePaused(){var e;const t=l.Y.Grid.Dataset.GAME_STATE;null===(e=this.probeCurrentGame)||void 0===e||e.statusBecomePaused(),this.pauseButton.textContent="Unpause",(0,i.YH)(this,y,document.hidden?"page-hide":"other"),this._gridBaseElem.dataset[t.KEY]=t.VALUES.PAUSED,this.pauseButton.onclick=this._statusBecomePlaying.bind(this),this.resetButton.disabled=!1}_onGameBecomeOver(){const e=l.Y.Grid.Dataset.GAME_STATE;this.pauseButton.disabled=!0,this.resetButton.disabled=!1,this._gridBaseElem.dataset[e.KEY]=e.VALUES.OVER}_resetGame(){this.currentGame.reset(),this.pauseButton.disabled=!1,this.wantsAutoPause&&this._statusBecomePlaying()}_initializeControlsBar(){const e=a.R.mkEl("div",[l.Y.General.Class.CENTER_CONTENTS,l.Y.General.Class.INPUT_GROUP,l.Y.Screen.Impl.Play.Class.CONTROLS_BAR]);function t(t,s){return(s=null!=s?s:a.R.mkEl("button",[])).classList.add(l.Y.General.Class.INPUT_GROUP_ITEM),s.textContent=t,s.addEventListener("pointerenter",(e=>{window.requestAnimationFrame((e=>{s.focus()}))})),e.appendChild(s),s}e.setAttribute("role","menu"),e.addEventListener("pointerleave",(e=>{window.requestAnimationFrame((e=>{this._gridBaseElem.focus()}))})),t("<Back Button Text>",this.nav.prev),this.pauseButton=t(""),(this.resetButton=t("Reset")).onclick=this._resetGame.bind(this),a.R.propNoWrite(this,["pauseButton","resetButton"]),this.baseElem.appendChild(e)}_initializePlayersBar(){const e=this.playersBar=a.R.mkEl("div",[l.Y.Screen.Impl.Play.Class.PLAYERS_BAR]);a.R.propNoWrite(this,["playersBar"]),this.baseElem.appendChild(e)}}R=new WeakMap,L=new WeakMap,A=new WeakMap,y=new WeakMap,function(e){e.createCenterColElem=function(){const e=l.Y.Grid.Class,t=l.Y.General.Class,s=a.R.mkEl("div",[l.Y.Screen.Impl.Play.Class.GRID_WRAPPER]),n=a.R.mkEl("div",[t.STACK_CONTENTS,t.TEXT_SELECT_DISABLED,e.GRID],{tabIndex:0});n.setAttribute("role","textbox"),n.setAttribute("aria-label","Game Grid");const r=a.R.mkEl("div",[e.SCROLL_OUTER]);r.setAttribute("role","presentation");{const s=a.R.mkEl("div",[t.FILL_PARENT,t.CENTER_CONTENTS,e.KBD_DC]);s.appendChild(a.R.mkEl("div",[e.KBD_DC_ICON],{textContent:"(click here to continue typing)"})),r.appendChild(s)}const o=a.R.mkEl("div",[t.FILL_PARENT,t.CENTER_CONTENTS,e.PAUSE_OL],{});return o.appendChild(a.R.mkEl("div",[e.PAUSE_OL_ICON],{textContent:"(Click to Unpause)"})),r.appendChild(o),n.appendChild(r),s.appendChild(n),Object.freeze({top:s,grid:n,intersectionRoot:r,implHost:r,pauseOl:o})}}(C||(C={})),a.R.protoNoEnum(C,["probeCurrentGame"]),a.R.instNoEnum(C,["createCenterColElem"]),Object.freeze(C),Object.freeze(C.prototype);class P extends C{constructor(){super(...arguments),this.wantsAutoPause=!0,this.askConfirmBeforeLeave=!0}_lazyLoad(){super._lazyLoad(),this.nav.prev.innerHTML="Return To&nbsp;Setup"}_createNewGame(e){return(0,i.mG)(this,void 0,void 0,(function*(){return new((yield Promise.all([s.e(929),s.e(755)]).then(s.bind(s,40))).OfflineGame)(this._onGameBecomeOver.bind(this),e)}))}}Object.freeze(P),Object.freeze(P.prototype);var k,G,w=s(502);class U extends d{constructor(){super(...arguments),k.set(this,void 0),G.set(this,!1)}get clientIsGroupHost(){return(0,i.Q_)(this,G)}_lazyLoad(){this.baseElem.classList.add(l.Y.General.Class.CENTER_CONTENTS,l.Y.Screen.Impl.GroupJoiner.Class.BASE);const e=this._initializeFormContents(),t=this._initializeHostUrlHandlers();this._initializeGroupNameHandlers(t),this._initializePassphraseHandlers(),this.nav.next.onclick=e=>{s()};const s=()=>{this.requestGoToScreen(d.Id.GROUP_LOBBY,{groupName:this.in.groupName.value,groupPassphrase:this.in.passphrase.value})};this._setFormState(H.CHOOSING_HOST),this.baseElem.appendChild(e)}getRecommendedFocusElem(){return void 0!==this.groupSocket?this.in.groupName:this.in.hostUrl}get state(){return(0,i.Q_)(this,k)}_setFormState(e){if(this.state!==e){if(e===H.IN_GROUP){if(this.state!==H.CHOOSING_GROUP)throw new Error("never");this.in.passphrase.disabled=!0,this.nav.next.disabled=!1,this.nav.next.focus()}else this.nav.next.disabled=!0,e===H.CHOOSING_HOST?(this.in.groupName.disabled=!0,this.in.groupName.value="",this.groupNameDataList.innerText="",this.in.passphrase.disabled=!0,this.in.passphrase.value="",this.in.hostUrl.focus()):e===H.CHOOSING_GROUP&&(this.in.groupName.disabled=!1,this.in.passphrase.disabled=!1,this.in.groupName.focus());(0,i.YH)(this,k,e)}}_initializeHostUrlHandlers(){const e=this.top,t=this.in.hostUrl,s=()=>(0,i.mG)(this,void 0,void 0,(function*(){var s,n;if(!t.value||!t.validity.valid)return;t.value.startsWith(w.b4.PROTOCOL)||(t.value=new window.URL(w.b4.PROTOCOL+t.value).origin);const r=new window.URL(t.value);if((null===(s=this.groupSocket)||void 0===s?void 0:s.io.opts.hostname)===r.hostname)return void(this.groupSocket.connected&&(this._setFormState(H.CHOOSING_GROUP),this.in.groupName.focus()));null===(n=this.joinerSocket)||void 0===n||n.close();const o=yield this.top.sockets.joinerSocketConnect({serverUrl:r});o.on("connect",(()=>{this._setFormState(H.CHOOSING_GROUP),o.on(w.ZA.Exist.EVENT_NAME,this._onNotifyGroupExist.bind(this))})).on("connect_error",(e=>{this.top.toast("Unable to connected to the specified server.")})).on("disconnect",(s=>{"io server disconnect"===s&&(this._setFormState(H.CHOOSING_HOST),t.value="",e.toast("The server disconnected you from the group joiner."))}))}));return t.oninput=e=>this._setFormState(H.CHOOSING_HOST),t.onkeydown=e=>{"Enter"===e.key&&s()},t.onpaste=e=>{window.setTimeout((()=>s()),0)},t.onchange=()=>{s()},s}_onNotifyGroupExist(e){if(e===w.ZA.Exist.RequestCreate.Response.NOPE)return void this.top.toast(`The server rejected your request to create a new group "${this.in.groupName.value}".`);if(e===w.ZA.Exist.RequestCreate.Response.OKAY)return this.top.toast(`server accepted request to create new group "${this.in.groupName.value}".`),this.top.toast("connecting to new group..."),void this._attemptToJoinExistingGroup();const t=this.groupNameDataList,s=Array.from(t.children);Object.entries(e).forEach((([e,n])=>{const r=s.find((t=>t.value===e))||(e=>{const n=a.R.mkEl("option",[],{value:e});for(const e of s)if(n.value.localeCompare(e.value)<0){t.insertBefore(n,e);break}return n.parentElement||t.appendChild(n),n})(e);switch(n){case w.ZA.Exist.Status.IN_LOBBY:r.textContent="In Lobby";break;case w.ZA.Exist.Status.IN_GAME:r.textContent="In Game";break;case w.ZA.Exist.Status.DELETE:r.remove()}}))}_initializeGroupNameHandlers(e){const t=this.in.groupName,s=()=>{t.value&&t.validity.valid&&(this.state===H.IN_GROUP?this.nav.next.focus():this.in.passphrase.focus())};this.in.groupName.oninput=t=>(0,i.mG)(this,void 0,void 0,(function*(){this.state===H.IN_GROUP&&(yield e()),this.in.passphrase.value="",(0,i.YH)(this,G,!1)})),t.onkeydown=e=>{"Enter"===e.key&&s()},t.onchange=e=>{s()}}_initializePassphraseHandlers(){const e=()=>(0,i.mG)(this,void 0,void 0,(function*(){if(this.in.passphrase.validity.valid)return void 0!==this.groupSocket&&this.groupSocket.nsp===w.b4.Nsps.GROUP_LOBBY_PREFIX+this.in.groupName.value?this.groupSocket.connected?(this._setFormState(H.IN_GROUP),void this.nav.next.focus()):void 0:void(Array.from(this.groupNameDataList.children).some((e=>e.value===this.in.groupName.value))?((0,i.YH)(this,G,!1),this._attemptToJoinExistingGroup()):((0,i.YH)(this,G,!0),this.joinerSocket.emit(w.ZA.Exist.EVENT_NAME,new w.ZA.Exist.RequestCreate(this.in.groupName.value,this.in.passphrase.value))))}));this.in.passphrase.onkeydown=t=>{"Enter"===t.key&&e()}}_attemptToJoinExistingGroup(){var e;null===(e=this.groupSocket)||void 0===e||e.close();const t=this.top,s=n.getLastUserInfo();this.top.sockets.groupSocketConnect(this.in.groupName.value,{passphrase:this.in.passphrase.value,userInfo:s}).on("connect",(()=>{this._setFormState(H.IN_GROUP)})).on("connect_error",(e=>{t.toast("Unable to connect to the specified group.")})).on("disconnect",(e=>{"io server disconnect"===e&&(t.toast("The server disconnected you from your group."),this.requestGoToScreen(d.Id.GROUP_JOINER,{}))}))}get joinerSocket(){return this.top.sockets.joinerSocket}get groupSocket(){return this.top.sockets.groupSocket}_initializeFormContents(){this.in={};const e=l.Y.Screen.Impl.GroupJoiner.Class,t=a.R.mkEl("div",[l.Y.General.Class.INPUT_GROUP,e.CONTENT_WRAPPER],{});function s(e,s){const n=a.R.mkEl("input",[l.Y.General.Class.INPUT_GROUP_ITEM,s],{type:"text",autocomplete:"off",spellcheck:!1}),r=a.R.mkEl("label",[],{textContent:e});return r.appendChild(n),t.appendChild(r),n}this.nav.prev.classList.add(l.Y.General.Class.INPUT_GROUP_ITEM),t.appendChild(this.nav.prev);{const t=this.in.hostUrl=Object.assign(s("Host URL",e.HOST_URL),{type:"url",maxLength:128,autocomplete:"on",required:!0}),n=U.SUGGEST_HOST(this.top.webpageHostType);if(n){const e=a.R.mkEl("option",[],{value:n.value,textContent:n.description});document.getElementById(l.Y.GLOBAL_IDS.PUBLIC_GAME_HOST_URLS).insertAdjacentElement("afterbegin",e)}t.setAttribute("list",l.Y.GLOBAL_IDS.PUBLIC_GAME_HOST_URLS)}{const t=this.in.groupName=Object.assign(s("Group Name",e.GROUP_NAME),{pattern:w.ZA.Name.REGEXP.source,minLength:1,maxLength:w.ZA.Name.MaxLength,autocomplete:"on",required:!0}),n=this.groupNameDataList=a.R.mkEl("datalist",[],{id:l.Y.GLOBAL_IDS.CURRENT_HOST_GROUPS});this.baseElem.appendChild(n),t.setAttribute("list",n.id)}{const t=this.in.passphrase=s("Group Passphrase",e.PASSPHRASE);t.pattern=w.ZA.Passphrase.REGEXP.source,t.maxLength=w.ZA.Passphrase.MaxLength}return this.nav.next.classList.add(l.Y.General.Class.INPUT_GROUP_ITEM),t.appendChild(this.nav.next),a.R.propNoWrite(this,["in","groupNameDataList"]),Object.freeze(this.in),t}}k=new WeakMap,G=new WeakMap,function(e){let t;!function(e){e.CHOOSING_HOST="choosing-host",e.CHOOSING_GROUP="choosing-group",e.IN_GROUP="in-group"}(t=e.State||(e.State={})),e.SUGGEST_HOST=function(e){switch(e){case"github":return;case"filesystem":return{value:"localhost:"+w.b4.DEFAULT_PORT,description:"dev shortcut :)"};case"sk-server":return{value:window.location.origin,description:"this page's server"};default:return}}}(U||(U={}));const H=U.State;Object.freeze(U),Object.freeze(U.prototype);class B extends S{_lazyLoad(){super._lazyLoad(),this.nav.next.textContent="Start Game",this.nav.next.onclick=e=>{const t=this.parseArgsFromGui();this.top.clientIsGroupHost&&this.top.sockets.groupSocket.emit(w.m4.CREATE_GAME,t)}}}Object.freeze(B),Object.freeze(B.prototype);const Y=l.Y.Screen.Impl.GroupLobby.Class;class j extends d{get socket(){return this.top.sockets.groupSocket}_lazyLoad(){this._players=new Map,this._createInputs(),this.nav.prev.textContent="Return To Joiner",this.teamsElem=a.R.mkEl("div",[Y.SEC_TEAMS]),this.baseElem.appendChild(this.teamsElem),this.teamElems=new Map,a.R.propNoWrite(this,["_players","teamsElem","teamElems","in"]);{const e=this.nav.next;e.textContent="Setup Game",e.onclick=()=>{this.requestGoToScreen(d.Id.SETUP_ONLINE,{})},this.baseElem.appendChild(e)}}_createInputs(){var e;const t=a.R.mkEl("div",[l.Y.General.Class.INPUT_GROUP,Y.SEC_CLIENT_INFO]),s=a.R.mkEl("input",[l.Y.General.Class.INPUT_GROUP_ITEM],{type:"text",minLength:1,maxLength:c.J5.Username.MAX_LENGTH,pattern:c.J5.Username.REGEXP.source,spellcheck:!1,value:null!==(e=this.top.storage.Local.username)&&void 0!==e?e:"",onchange:this._submitInputs.bind(this)});t.appendChild(s);const n=a.R.mkEl("input",[l.Y.General.Class.INPUT_GROUP_ITEM],{type:"number",inputMode:"numeric",min:"0",max:"0",step:"1",value:"0",onchange:this._submitInputs.bind(this)});n.classList.add(),t.appendChild(n);const r=a.R.mkEl("select",[]);this.in=Object.freeze({username:s,teamId:n,avatar:r}),this.baseElem.appendChild(t)}_submitInputs(){this.in.username.validity.valid&&this.in.teamId.validity.valid&&(this.top.storage.Local.username=this.in.username.value,this.top.storage.Local.avatar=this.in.avatar.value,this.socket.emit(w.ZA.Socket.UserInfoChange.EVENT_NAME,{username:this.in.username.value,teamId:parseInt(this.in.teamId.value),avatar:c.J5.Avatar.LOREM_IPSUM}))}_abstractOnBeforeEnter(e,t){return(0,i.mG)(this,void 0,void 0,(function*(){"forward"===e&&(this.nav.next.disabled=!this.top.clientIsGroupHost,this._players.clear(),this.teamElems.clear(),this.teamsElem.textContent="",this._submitInputs(),this.socket.on(w.ZA.Socket.UserInfoChange.EVENT_NAME,this._onUserInfoChange.bind(this))),this.socket.once(w.m4.CREATE_GAME,(()=>{console.log("group create game socket. now waiting for ctor args"),this.top.sockets.gameSocketConnect(t.groupName,{passphrase:t.groupPassphrase}).once(w.JD.CREATE_GAME,(e=>{this.requestGoToScreen(d.Id.PLAY_ONLINE,e)}))}))}))}getRecommendedFocusElem(){let e=this.in.username.validity.valid?this.in.teamId.validity.valid?void 0:this.in.teamId:this.in.username;return void 0===e&&(e=this.top.clientIsGroupHost?this.nav.next:this.in.teamId),e}_abstractOnBeforeLeave(e){return e===d.NavDir.BACKWARD&&this.socket.removeListener(w.m4.CREATE_GAME),!0}_onUserInfoChange(e){Object.entries(e).forEach((([e,t])=>{const s=this._players.get(e);if(!s||1!==this.teamElems.get(s.teamId).childElementCount||void 0!==t&&t.teamId===s.teamId||(this.teamElems.get(s.teamId).remove(),this.teamElems.delete(s.teamId)),t&&!this.teamElems.has(t.teamId)){const e=a.R.mkEl("div",[Y.TEAM]);this.teamElems.set(t.teamId,e),e.onclick=e=>{this.in.teamId.value=t.teamId.toString()},this.teamsElem.appendChild(e)}if(void 0===t)s.base.remove(),this._players.delete(e);else if(void 0===s){const s=new j.UserInfo(t);this._players.set(e,s),this.teamElems.get(t.teamId).appendChild(s.base)}else s.update(t)})),this.in.teamId.max=Object.keys(this._players).length.toString()}}!function(e){var t,s,n;t=new WeakMap,s=new WeakMap,n=new WeakMap,e.UserInfo=class{constructor(e){t.set(this,void 0),s.set(this,void 0),n.set(this,void 0),this.base=a.R.mkEl("div",[Y.PLAYER]);const r=()=>{const e=a.R.mkEl("div",[]);return this.base.appendChild(e),e};this.el=Object.freeze({username:r(),teamId:r(),avatar:r()}),this.el.username.classList.add(Y.PLAYER_NAME),this.username=e.username,this.teamId=e.teamId,a.R.propNoWrite(this,["base","el"])}update(e){this.username=e.username,this.teamId=e.teamId,this.avatar=e.avatar}get username(){return(0,i.Q_)(this,t)}set username(e){this.el.username.textContent=e,(0,i.YH)(this,t,e)}get teamId(){return(0,i.Q_)(this,s)}set teamId(e){this.el.teamId.textContent=e.toString(),(0,i.YH)(this,s,e)}get avatar(){return(0,i.Q_)(this,n)}set avatar(e){(0,i.YH)(this,n,e),this.el.avatar}}}(j||(j={})),a.R.protoNoEnum(j,["_createInputs","_submitInputs"]),Object.freeze(j),Object.freeze(j.prototype);class D extends C{constructor(){super(...arguments),this.askConfirmBeforeLeave=!1,this.wantsAutoPause=!1}get socket(){return this.top.sockets.gameSocket}_lazyLoad(){super._lazyLoad(),this.nav.prev.innerHTML="Return To&nbsp;Lobby"}_abstractOnBeforeLeave(e){const t=super._abstractOnBeforeLeave(e);return t&&(this.socket.emit(w.JD.RETURN_TO_LOBBY),this.socket.removeAllListeners()),t}_createNewGame(e){return(0,i.mG)(this,void 0,void 0,(function*(){const t=new((yield Promise.all([s.e(929),s.e(775)]).then(s.bind(s,25))).OnlineGame)(this._onGameBecomeOver.bind(this),this.top.sockets.gameSocket,e);return this.top.sockets.gameSocket.on(w.JD.UNPAUSE,(()=>{this._statusBecomePlaying()})).on(w.JD.PAUSE,(()=>{this._statusBecomePaused()})).on(w.JD.RETURN_TO_LOBBY,(e=>{void 0===e&&this.nav.prev.click()})),Promise.resolve(t)}))}_onGameBecomeOver(){super._onGameBecomeOver()}}var x,z,M,F,W;Object.freeze(D),Object.freeze(D.prototype);class V{constructor(e,t){x.set(this,void 0),z.set(this,void 0),(0,i.YH)(this,z,e.transition),t.setAttribute("role","presentation");const s=d.Id,n=e,r=t,o=Object.freeze(this.goToScreen.bind(this));this.dict=Object.freeze({[s.HOME]:new h(s.HOME,n,r,o),[s.HOW_TO_PLAY]:new u(s.HOW_TO_PLAY,n,r,o),[s.HOW_TO_HOST]:new m(s.HOW_TO_HOST,n,r,o),[s.COLOUR_CTRL]:new g(s.COLOUR_CTRL,n,r,o),[s.SETUP_OFFLINE]:new N(s.SETUP_OFFLINE,n,r,o),[s.PLAY_OFFLINE]:new P(s.PLAY_OFFLINE,n,r,o),[s.GROUP_JOINER]:new U(s.GROUP_JOINER,n,r,o),[s.SETUP_ONLINE]:new B(s.SETUP_ONLINE,n,r,o),[s.GROUP_LOBBY]:new j(s.GROUP_LOBBY,n,r,o),[s.PLAY_ONLINE]:new D(s.PLAY_ONLINE,n,r,o)}),a.R.propNoWrite(this,["dict"]);const l=d.NavTree[window.location.hash.slice(1)];window.setTimeout((()=>{var e;this.goToScreen(null!==(e=null==l?void 0:l.href)&&void 0!==e?e:d.Id.HOME,{})}),75),window.addEventListener("popstate",(e=>{this.goToScreen(window.history.state.screenId,{})}))}goToScreen(e,t){return(0,i.mG)(this,void 0,void 0,(function*(){const s=this.currentScreen,n=this.dict[e];if(s===n)throw new Error("never");(0,i.YH)(this,x,n);const r=d.GET_NAV_DIR({curr:null==s?void 0:s.screenId,dest:e});return!(void 0!==s&&!s._leave(r)||(yield(0,i.Q_)(this,z).do({beforeUnblurAwait:n._enter(r,t),beforeUnblur:()=>{var e;null==s||s._onAfterLeave(),n._onAfterEnter(),null===(e=n.getRecommendedFocusElem())||void 0===e||e.focus()}}),0))}))}get currentScreen(){return(0,i.Q_)(this,x)}}x=new WeakMap,z=new WeakMap,Object.freeze(V),Object.freeze(V.prototype);class K{constructor(){M.set(this,void 0),this.baseElem=document.getElementById(l.Y.Screen.Id.SCREEN_TINT),(0,i.YH)(this,M,void 0),a.R.propNoWrite(this,["baseElem"])}do(e){var t;return(0,i.YH)(this,M,(null!==(t=(0,i.Q_)(this,M))&&void 0!==t?t:Promise.resolve()).then((()=>this._atomicDo(e)))),(0,i.Q_)(this,M)}_atomicDo(e){return(0,i.mG)(this,void 0,void 0,(function*(){const t=this.baseElem.style;yield this._triggerCssTransition((()=>{t.pointerEvents="all",t.opacity="1.0"})),void 0!==e.intermediateTransitionTrigger&&(yield this._triggerCssTransition((()=>{e.intermediateTransitionTrigger()}))),yield e.beforeUnblurAwait,void 0!==e.beforeUnblur&&e.beforeUnblur(),yield this._triggerCssTransition((()=>{t.pointerEvents="none",t.opacity="0.0"}))}))}_triggerCssTransition(e){return new Promise(((t,s)=>{this.baseElem.addEventListener("transitionend",(()=>t()),{once:!0}),e()}))}}M=new WeakMap,a.R.protoNoEnum(K,["_atomicDo","_triggerCssTransition"]),Object.freeze(K),Object.freeze(K.prototype);class J{constructor(){F.set(this,void 0),(0,i.YH)(this,F,{joiner:void 0,group:void 0,game:void 0})}get socketIo(){return new Promise(((e,t)=>{const s=a.R.mkEl("script",[]);s.onload=()=>{e(io)},s.src=document.getElementById("socket.io-preload").href,document.body.appendChild(s)}))}get joinerSocket(){return(0,i.Q_)(this,F).joiner}get groupSocket(){return(0,i.Q_)(this,F).group}get gameSocket(){return(0,i.Q_)(this,F).game}joinerSocketConnect(e){return(0,i.mG)(this,void 0,void 0,(function*(){const t=(yield this.socketIo).Manager(e.serverUrl.toString(),{reconnectionAttempts:w.ZA.GameServerReconnectionAttempts}).socket(w.b4.Nsps.GROUP_JOINER);return this._registerSocket(t,"joiner"),t}))}groupSocketConnect(e,t){return this._groupSocketHelper("group",e,t)}gameSocketConnect(e,t){return this._groupSocketHelper("game",e,t)}_groupSocketHelper(e,t,s){let n;switch(e){case"group":n=w.b4.Nsps.GROUP_LOBBY_PREFIX;break;case"game":n=w.b4.Nsps.GROUP_GAME_PREFIX;break;default:throw new TypeError("never")}const r=this.joinerSocket.io.socket(n+t,s);return this._registerSocket(r,e),r}_registerSocket(e,t){(0,i.Q_)(this,F)[t]=e;const s=()=>{e.removeAllListeners(),e.close(),(0,i.Q_)(this,F)[t]=void 0};e.on("connect_error",(e=>{s()})).on("disconnect",(e=>{"io server disconnect"!==e&&"io client disconnect"!==e||s()}))}}F=new WeakMap,a.R.protoNoEnum(J,["joinerSocketConnect","groupSocketConnect","gameSocketConnect","_groupSocketHelper","_registerSocket"]),Object.freeze(J),Object.freeze(J.prototype);class Q{constructor(){W.set(this,void 0),this.defaultDocTitle=document.title,this.webpageHostType=window.location.origin.match(/github\.io/)?Q.WebpageHostType.GITHUB:window.location.protocol.startsWith("file")?Q.WebpageHostType.FILESYSTEM:Q.WebpageHostType.SNAKEY_SERVER,a.R.propNoWrite(this,["defaultDocTitle","webpageHostType"]),this.storage=n,this.sockets=new J,this.transition=new K,a.R.propNoWrite(this,["storage","sockets","transition"]);const e=document.getElementById(l.Y.Screen.Id.ALL_SCREENS);if(!e)throw new Error("never");a.R.prependComment(e,"ALL SCREENS CONTAINER"),(0,i.YH)(this,W,new V(this,e)),a.R.propNoWrite(this,[])}get clientIsGroupHost(){return(0,i.Q_)(this,W).dict.groupJoiner.clientIsGroupHost}toast(e){console.info(e)}get game(){var e;return null!==(e=(0,i.Q_)(this,W).dict.playOffline.probeCurrentGame)&&void 0!==e?e:(0,i.Q_)(this,W).dict.playOnline.probeCurrentGame}get currentScreen(){return(0,i.Q_)(this,W).currentScreen}}W=new WeakMap,function(e){let t;!function(e){e.GITHUB="github",e.FILESYSTEM="filesystem",e.SNAKEY_SERVER="sk-server"}(t=e.WebpageHostType||(e.WebpageHostType={}))}(Q||(Q={})),Object.freeze(Q),Object.freeze(Q.prototype),Object.freeze(Object.prototype);const q=new Q,X=q;function Z(){return q.currentScreen}function $(){return q.game}console.log("%cðŸ©º welcome! ðŸ","font:700 2.3em /1.5 monospace; margin:0.4em; border:0.3em solid black;padding:0.4em; color:white; background-color:#3f5e77; border-radius:0.7em; "),q.webpageHostType===Q.WebpageHostType.GITHUB&&"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/ServiceWorker.js").then((e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)}),(e=>{console.log("ServiceWorker registration failed: ",e)}))}))},655:(e,t,s)=>{function n(e,t,s,n){return new(s||(s=Promise))((function(r,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}l((n=n.apply(e,t||[])).next())}))}function r(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function o(e,t,s){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,s),s}s.d(t,{mG:()=>n,Q_:()=>r,YH:()=>o}),Object.create,Object.create}},o={};function i(e){if(o[e])return o[e].exports;var t=o[e]={exports:{}};return r[e](t,t.exports,i),t.exports}return i.m=r,i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,s)=>(i.f[s](e,t),t)),[])),i.u=e=>"chunk/"+({184:"lang/English-ts",227:"lang/Korean-ts",285:"lang/Morse-ts",410:"lang/Japanese-ts",755:"game/offline",775:"game/online",858:"lang/Emote-ts"}[e]||e)+".js",i.miniCssF=e=>826===e?"_barrel.css":"chunk/"+({184:"lang/English-ts",227:"lang/Korean-ts",285:"lang/Morse-ts",410:"lang/Japanese-ts",755:"game/offline",775:"game/online",858:"lang/Emote-ts"}[e]||e)+".css",i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="snakey3:",i.l=(s,n,r)=>{if(e[s])e[s].push(n);else{var o,a;if(void 0!==r)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var p=l[c];if(p.getAttribute("src")==s||p.getAttribute("data-webpack")==t+r){o=p;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+r),o.src=s),e[s]=[n];var d=(t,n)=>{o.onerror=o.onload=null,clearTimeout(h);var r=e[s];if(delete e[s],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(n))),t)return t(n)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),a&&document.head.appendChild(o)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="./",s=e=>new Promise(((t,s)=>{var n=i.miniCssF(e),r=i.p+n;if(((e,t)=>{for(var s=document.getElementsByTagName("link"),n=0;n<s.length;n++){var r=(i=s[n]).getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(r===e||r===t))return i}var o=document.getElementsByTagName("style");for(n=0;n<o.length;n++){var i;if((r=(i=o[n]).getAttribute("data-href"))===e||r===t)return i}})(n,r))return t();((e,t,s,n)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.onerror=r.onload=o=>{if(r.onerror=r.onload=null,"load"===o.type)s();else{var i=o&&o.target&&o.target.href||t,a=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=i,r.parentNode.removeChild(r),n(a)}},r.href=t,document.head.appendChild(r)})(e,r,t,s)})),n={826:0},i.f.miniCss=(e,t)=>{n[e]?t.push(n[e]):0!==n[e]&&{755:1,775:1}[e]&&t.push(n[e]=s(e).then((()=>{n[e]=0}),(t=>{throw delete n[e],t})))},(()=>{var e={826:0};i.f.j=(t,s)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var r=new Promise(((s,r)=>{n=e[t]=[s,r]}));s.push(n[2]=r);var o=i.p+i.u(t),a=new Error;i.l(o,(s=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",a.name="ChunkLoadError",a.type=r,a.request=o,n[1](a)}}),"chunk-"+t)}};var t=self.webpackChunksnakey3=self.webpackChunksnakey3||[],s=t.push.bind(t);t.push=t=>{for(var n,r,[o,a,l]=t,c=0,p=[];c<o.length;c++)r=o[c],i.o(e,r)&&e[r]&&p.push(e[r][0]),e[r]=0;for(n in a)i.o(a,n)&&(i.m[n]=a[n]);for(l&&l(i),s(t);p.length;)p.shift()()}})(),i(735)})();
//# sourceMappingURL=index.js.map